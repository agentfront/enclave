---
title: 'enclave-vm'
description: 'Secure AgentScript execution environment with defense-in-depth'
---

# enclave-vm

Secure AgentScript execution environment with defense-in-depth architecture for running LLM-generated JavaScript safely.

## Installation

```bash
npm install enclave
```

## Quick Start

```typescript
import { Enclave } from 'enclave-vm';

const enclave = new Enclave({ securityLevel: 'SECURE' });

const result = await enclave.execute(`
  const sum = 1 + 2;
  return sum;
`);

console.log(result.value); // 3
```

## Features

- **Bank-grade Security**: 516+ security tests, 81+ blocked attack vectors
- **Defense-in-depth**: 6 security layers
- **Worker Pool Adapter**: Isolated execution in separate processes
- **Reference Sidecar**: Sandboxed environments for untrusted code

## Security Levels

| Level | Description |
|-------|-------------|
| `STRICT` | Maximum security, minimal features |
| `SECURE` | Balanced security for most use cases |
| `STANDARD` | Standard security with more features |
| `PERMISSIVE` | Minimal restrictions |

## Defense Layers

1. **AST Validation** - Static analysis of code structure
2. **Pre-scanner** - Pattern-based threat detection
3. **Runtime Proxy** - Intercepts dangerous operations
4. **Globals Validation** - Restricts global access
5. **Value Sanitization** - Cleans return values
6. **Timeout/Memory Limits** - Resource constraints

## API

### `execute(code, options)`

Execute JavaScript code in a secure environment.

```typescript
const result = await enclave.execute(code, {
  timeout: 5000,
  maxMemory: 128 * 1024 * 1024
});

if (result.success) {
  console.log(result.value);
} else {
  console.log(result.error);
}
```

### `dispose()`

Clean up resources.

```typescript
enclave.dispose();
```

## Worker Pool Adapter

For complete process isolation:

```typescript
import { Enclave, WorkerPoolAdapter } from 'enclave-vm';

const enclave = new Enclave({
  securityLevel: 'SECURE',
  adapter: new WorkerPoolAdapter({ poolSize: 4 })
});
```

## Local LLM Scoring

Leverage the Local LLM scorer to gate executions with on-disk models.

**Note:** `LocalLlmScorer` loads the optional `@huggingface/transformers` peer dependency on demand. Install it before enabling local scoring:

```bash
npm install @huggingface/transformers
```

```typescript
import { LocalLlmScorer } from 'enclave-vm/scoring';

const scorer = new LocalLlmScorer({
  modelId: 'Xenova/codebert-base',
  mode: 'classification',
  cacheDir: '~/.enclave/models'
});
```

### `LocalLlmConfig`

- `modelId` (required): Hugging Face identifier such as `Xenova/codebert-base`
- `mode` (optional): `'classification'` (default) or `'similarity'`
- `cacheDir` (optional): Directory for cached models, default `~/.enclave/models`
- `vectoriaConfig` (optional): VectoriaDB settings required when `mode` is `'similarity'`

## Links

- [GitHub](https://github.com/agentfront/enclave/tree/main/libs/enclave)
- [npm](https://www.npmjs.com/package/enclave-vm)
