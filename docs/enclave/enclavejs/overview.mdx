---
title: 'EnclaveJS Streaming Runtime'
description: 'Real-time streaming execution environment for AI agents with tool orchestration'
---

# EnclaveJS Streaming Runtime

EnclaveJS is a streaming runtime layer built on top of `@enclave-vm/core` that enables real-time code execution with tool orchestration, session management, and client SDKs for browser and React applications.

## Architecture

EnclaveJS provides a distributed architecture for executing AI-generated code with streaming results:

```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│   React App     │      │     Broker      │      │    Runtime      │
│  (@enclave-vm/  │ HTTP │  (@enclave-vm/  │  WS  │  (@enclave-vm/  │
│    react)       │─────▶│    broker)      │─────▶│    runtime)     │
└─────────────────┘      └─────────────────┘      └─────────────────┘
         │                        │                        │
         │                        │                        │
         ▼                        ▼                        ▼
   useEnclaveSession        Tool Registry            enclave-vm
   EnclaveProvider          Session Manager          Sandboxed Code
```

## Packages

<CardGroup cols={2}>
  <Card title="@enclave-vm/types" icon="code" href="/enclavejs/types">
    Protocol types and Zod schemas for the streaming runtime
  </Card>
  <Card title="@enclave-vm/stream" icon="wave-pulse" href="/enclavejs/stream">
    NDJSON streaming, encryption, and reconnection handling
  </Card>
  <Card title="@enclave-vm/broker" icon="server" href="/enclavejs/broker">
    Tool broker with session management and HTTP API
  </Card>
  <Card title="@enclave-vm/client" icon="plug" href="/enclavejs/client">
    Browser and Node.js client SDK
  </Card>
  <Card title="@enclave-vm/react" icon="react" href="/enclavejs/react">
    React hooks and components
  </Card>
  <Card title="@enclave-vm/runtime" icon="microchip" href="/enclavejs/runtime">
    Standalone deployable runtime worker
  </Card>
</CardGroup>

## Key Features

- **Real-time Streaming**: NDJSON-based protocol for streaming stdout, logs, and tool calls
- **Tool Orchestration**: Define tools with Zod schemas, handle tool calls during execution
- **Session Management**: Track execution sessions with limits, stats, and lifecycle management
- **End-to-end Encryption**: Optional ECDH + AES-256-GCM encryption for sensitive workloads
- **Automatic Reconnection**: Built-in reconnection with sequence tracking and event buffering
- **React Integration**: First-class React hooks for building interactive code execution UIs

## Quick Start

### Server Setup (Broker)

```typescript
import { Broker, createBroker } from '@enclave-vm/broker';
import { z } from 'zod';

const broker = createBroker({
  securityLevel: 'SECURE',
});

// Register a tool
broker.tool('getCurrentTime', {
  description: 'Get the current time',
  argsSchema: z.object({
    timezone: z.string().optional(),
  }),
  handler: async ({ timezone }) => {
    return new Date().toLocaleString('en-US', { timeZone: timezone });
  },
});

// Execute code with streaming
const stream = broker.execute(`
  const time = await tools.getCurrentTime({ timezone: 'America/New_York' });
  console.log('Current time:', time);
  return time;
`);

for await (const event of stream) {
  console.log(event.type, event.payload);
}
```

### Client Setup (React)

```tsx
import { EnclaveProvider, useEnclaveSession } from '@enclave-vm/react';

function App() {
  return (
    <EnclaveProvider brokerUrl="http://localhost:3000">
      <CodeExecutor />
    </EnclaveProvider>
  );
}

function CodeExecutor() {
  const { execute, state, stdout, result, error } = useEnclaveSession();

  const runCode = async () => {
    await execute(`
      console.log('Hello from the sandbox!');
      return 42;
    `);
  };

  return (
    <div>
      <button onClick={runCode} disabled={state === 'running'}>
        {state === 'running' ? 'Running...' : 'Run Code'}
      </button>
      <pre>{stdout}</pre>
      {result && <div>Result: {JSON.stringify(result)}</div>}
      {error && <div>Error: {error.message}</div>}
    </div>
  );
}
```

## Deployment Modes

### Embedded Mode

The broker runs the sandbox directly (simplest setup):

```typescript
const broker = createBroker({ mode: 'embedded' });
```

### Extracted Mode

The broker connects to a separate runtime worker via WebSocket (for isolation/scaling):

```typescript
// Broker
const broker = createBroker({
  mode: 'extracted',
  runtimeUrl: 'ws://localhost:3001',
});

// Runtime Worker
import { createRuntimeWorker } from '@enclave-vm/runtime';

const worker = createRuntimeWorker({ port: 3001 });
await worker.start();
```

## Stream Events

The streaming protocol emits these event types:

| Event Type | Description |
|------------|-------------|
| `session_init` | Session started with config |
| `stdout` | Console output chunk |
| `log` | Log message (debug/info/warn/error) |
| `tool_call` | Tool execution request |
| `tool_result_applied` | Tool result acknowledgment |
| `heartbeat` | Keep-alive message |
| `final` | Session completed with stats |
| `error` | Execution error |

## Links

- [GitHub](https://github.com/agentfront/enclave)
- [npm @enclave-vm](https://www.npmjs.com/org/enclave-vm)
